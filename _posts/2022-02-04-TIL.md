---
title: TIL 2022-02-04 python 딥러닝
tags: [TIL, python]
categories: TIL
---

# 오늘 배운 것 

- Segmentation
  - FCN (Fully convolutional network for semantic segmentation)
    - 차원 축소된 응축 정보를 가지고 다시 복원 하면서 필요한 정보를 학습 (encoding - decoding)
    - 재창조, 재해석 
    - flatten 이 아닌 convolution 한 feature map 
    - 원본사이즈를 계속 줄이면서 depth는 계속 늘어남 -> 다시 32배 업샘플링(deconvolution)-> 개별 픽셀 학습, 가중치 계산 
      - 위치정보가 뭉개지지 않도록 마지막 conv 를 2배 + 그 직전 pool과 합침 -> 2배 -> 그 직전 pool과 합침 
  - Mask RCNN 
    - Faster RCNN + FCN 
      - ROI-Align
      - bounding box regression / classfication + binary mask prediction(masking 이냐 아니냐 )
    - 구조 
      - Region Proposal Network 
      - ROI Align (input 과 feature map size 가 안맞을 때 배율 맞출때 손실을 보완 하기 위해)
      - Fully Connected -> bbox regression , classification
      - mask 영역 prediction
    - ROI pooling 문제 
      - quantize 할때 input 과 feature map size 가 안맞을 때 배율 맞출때 손실(소숫점)
      - 2*2 ROI Max pooling 시 배율이 안맞으면 안맞는 비율로 분면이나눠짐 
    - ROI-Align
      - 그리드에 맞추지 말고, 원본 이미지 대비 줄어드는 스케일 영역을 생각해서 가상의 소숫점을 사용해서 영역을 나누자!
      - 4개 분면 안에 분면을 한번 더 균등하게 쪼갬 (4개 포인트 배열)
      - 개별 포인트에서 가장 가까운 feature map grid 를 고려 하면서 포인트를 weighted sum으로 계산
      - 그리고 각 분면의 값 max pooling 
    - Feature Extractor 
      - Resnet + FPN
    - Mask RCNN Loss function 
      - L = Lcls + Lbbox + Lmask 
      - classfication Loss =  Multiclass cross-entropy loss 
      - bounding box loss  = Smooth L1 loss 
      - Mask loss 
        - k개의 클래스에 속하는지 아닌지를 sigmoid 로 결정 (이진)
- MS COCO 데이터 포맷 상세 이해
  - 데이터 세트 구조 : jpg 여러개 -> train 용 json file / valid 용 
  - json annotation file 
    - info : 헤더 
    - license : 이미지 파일의 license
    - images : 이미지 id, file 명, 이미지 너비, 높이 
    - annotations  : 대상 이미지 , object id, segmentation, bounding box , 픽셀영역등 
    - categories  :  80개 오브젝트 카테고리 아이디, 이름, 그룹
  - annotation 포맷 
    - segmentation : 폴리곤 형태 
    - area : bounding box 
- pycocotools 이해와 활용
    - jq -> json file 보기 쉽게 구조 변경해주는 프로그램 
    - COCO API를 활용하기 위해 annotation 파일을 COCO 객체로 로드하기 ( coco=COCO(annFile)
    - loadCats()는 category id 리스트를 입력받아 category들에 대한 세부 정보를 여러개의 딕셔너리를 개별 원소를 가지는 리스트로 반환
    - annotation json 의 segmentation 폴리곤 정보
    - matplotlib + coco.showAnns
- Polygon과 Mask Segmentation 시각화
  - polygon -> 윤곽선
      - cv2.fillPol
      - coco.annToMask(anns[2])
  - 마스크 이미지 -> 윤곽선 
    - cv2.findContour
    - cv2.drawContour
- Find the nuclei in divergent images to advance medical discovery
  - 입력 데이터 처리 
    - 데이터 구조 파악하기 
    - 데이터 절대 경로 추출 
    - 개별 이미지 , 마스크 이름 추출 -> 코코 데이터 셋 만들기 위해 
    - Nucleus image의 유형별 분류 시각화
      - 각 이미지들의 cluster center 구하고( KMeans ,fit -> cluster_centers_) 
      - 모든 이미지들의 cluster center 구해서 유형 찾아내기 
      - 메타 데이터 만들기 
      - mask -> shape 보고 RLE 못만드는 것들 걸러내기 
      - bounding box 정보를 polygon에서 추출 